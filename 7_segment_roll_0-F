;!!! CODE JUMPING OUT OF LOOKUP TABLE !!!

PROCESSOR 16F887
#include <xc.inc>

CONFIG LVP=OFF
CONFIG FCMEN=OFF
CONFIG IESO=OFF
CONFIG BOREN=OFF
CONFIG CPD=OFF
CONFIG CP=OFF
CONFIG MCLRE=ON
CONFIG PWRTE=ON
CONFIG WDTE=OFF
CONFIG FOSC=INTRC_NOCLKOUT
CONFIG WRT=OFF
CONFIG BOR4V=BOR21V
    
TIM1	EQU	0x20
TIM2	EQU	0x21
STEP	EQU	0x22

PSECT resetVect
resetVect:
	GOTO	INIT_PROG
	
PSECT code
	ORG	    0x0004
	GOTO	START
INIT_PROG:
	BANKSEL	TRISD
	CLRF	TRISD
	BANKSEL	PORTD
	MOVLW	0x00	;0x0 into W
	MOVWF	STEP	;0x0 into STEP
						;CLRF	STEP
START:
	MOVLW	0x0F	;00001111 into W REG
						;1 MOVF	STEP, 0
						;1 ANDLW	0x0F
						;1 MOVWF	F
	ANDWF	STEP,W	;W REG AND STEP, into W
	;Max value 00001111
						;MOVF	STEP, 0
	CALL	SEG_LOOKUP
	MOVWF	PORTD
	INCF	STEP
	CALL	WAIT
	GOTO	START
WAIT:
	CLRF	TIM1
	MOVLW	0xFF
	MOVWF	TIM2
DELAY:
	DECFSZ	TIM1
	GOTO	DELAY
	DECFSZ	TIM2
	GOTO	DELAY
	
	RETURN

SEG_LOOKUP:
	ADDWF	PCL,1	;W added to PCL, loaded into PCL
	RETLW	0x3F
	RETLW	0x06
	RETLW	0x5B
	RETLW	0x4F
	RETLW	0x66
	RETLW	0x6D
	RETLW	0x7D
	RETLW	0x07
	RETLW	0x7F
	RETLW	0x6F
	RETLW	0x77
	RETLW	0x7C
	RETLW	0x39
	RETLW	0x5E
	RETLW	0x79
	RETLW	0x71
END
